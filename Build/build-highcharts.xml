<?xml version="1.0"?>
<project name="Hello World" default="run" xmlns="http://nant.sf.net/release/0.85/nant.xsd">
  <property name="nant.settings.currentframework" value="net-4.0"/>
  <property name="version" value="4_1_7_0"/>
  <property name="debug" value="false"/>
  <property name="csc.licensed" value="LICENSED"/>
  <property name="base.dir" value="c:\highsoft\deliverables\highcharts"/>
  <property name="deliverable.mvc.name" value="Highcharts_ASPNET_MVC_${version}.zip" />
  <property name="licensed.deliverable.mvc.name" value="Highcharts_ASPNET_MVC_Licensed_${version}.zip"/>
  <property name="source.name.mvc" value="Highcharts_ASPNET_MVC_Source_${version}.zip"/>
  <property name="assembly.name.mvc" value="Highcharts.Web.Mvc.dll"/>
  <property name="project.folder.mvc" value="C:\highsoft\mvc_highcharts"/>
  <property name="sample.project.mvc.folder" value="C:\highsoft\mvc_demo" />
  <property name="compiledon.utility.path" value="C:\highsoft\utildatereplacer\bin\Release\utildatereplacer.exe" />
  <!-- comment-->

  <target name="clean">
    <delete dir="${base.dir}" includeemptydirs="true" />
    <mkdir dir="${base.dir}" />
    <mkdir dir="${base.dir}\bin" />
    <mkdir dir="${base.dir}\bin\trial" />
    <mkdir dir="${base.dir}\bin\licensed" />
  </target>

  <target name="generateCompiledOnStampMvc">
    <exec program="${compiledon.utility.path}">
      <arg value="${project.folder.mvc}\CompiledOn.cs" />
      <arg value="Highsoft.Web.Mvc.Charts" />
    </exec>
  </target>

  <target name="generateCompiledOnStampMvcSource">
    <exec program="${compiledon.utility.path}">
      <arg value="${project.folder.mvc}\CompiledOn.cs" />
      <arg value="Highsoft.Web.Mvc.Charts" />
      <arg value="true" />
    </exec>
  </target>

  <target name="buildTrialMvc">
    <csc target="library" output="${base.dir}\bin\trial\${assembly.name.mvc}"
         debug="${debug}" optimize="true" rebuild="true" keyfile="${project.folder.mvc}\highcharts.snk">
      <references>
        <include name="System.dll"/>
        <include name="System.Core.dll"/>
        <include name="System.Data.dll"/>
        <include name="System.Data.DataSetExtensions.dll"/>
        <include name="System.Design.dll"/>
        <include name="Systen.Drawing.dll"/>
        <include name="System.Web.dll"/>
        <include name="System.Web.Extensions.dll"/>
        <include name="${project.folder.mvc}\bin\debug\System.Web.Mvc.dll"/>
        <include name="System.Xml.dll"/>
        <include name="System.Xml.Linq.dll"/>
      </references>
      <sources basedir="${project.folder.mvc}">
        <include name="**/*.cs" />
      </sources>
    </csc>
  </target>

  <target name="buildLicensedMvc">
    <csc target="library" output="${base.dir}\bin\licensed\${assembly.name.mvc}" debug="${debug}"
         define="${csc.licensed};" optimize="true" rebuild="true" keyfile="${project.folder.mvc}\highcharts.snk">
      <references>
        <include name="System.dll"/>
        <include name="System.Core.dll"/>
        <include name="System.Data.dll"/>
        <include name="System.Data.DataSetExtensions.dll"/>
        <include name="System.Design.dll"/>
        <include name="Systen.Drawing.dll"/>
        <include name="System.Web.dll"/>
        <include name="System.Web.Extensions.dll"/>
        <include name="${project.folder.mvc}\bin\debug\System.Web.Mvc.dll"/>
        <include name="${project.folder.mvc}\bin\debug\System.Web.Routing.dll"/>
        <include name="System.Xml.dll"/>
        <include name="System.Xml.Linq.dll"/>
      </references>
      <sources basedir="${project.folder.mvc}">
        <include name="**/*.cs" />
      </sources>
    </csc>
  </target>


  <target name="copySampleSiteMvc">
    <copy todir="${base.dir}\trialMvc">
      <fileset basedir="${sample.project.mvc.folder}">
        <includes name="**/*.*"/>
        <excludes name="Help/**" />
        <excludes name="downloads/**" />
        <excludes name="obj/**" />
        <excludes name="**/Highsoft.Web.Mvc.Highcharts.pdb" />
        <excludes name="**/Highsoft.Web.Mvc.Highcharts.xml" />
      </fileset>
    </copy>
    <copy todir="${base.dir}\licensedMvc">
      <fileset basedir="${sample.project.mvc.folder}">
        <includes name="**/*.*"/>
        <excludes name="Help/**" />
	  <excludes name="downloads/**" />
        <excludes name="obj/**" />
        <excludes name="**/Highsoft.Web.Mvc.Highcharts.pdb" />
        <excludes name="**/Highsoft.Web.Mvc.Highcharts.xml" />
      </fileset>
    </copy>
  </target>


  <target name="updateBinariesMvc">
    <delete file="${sample.project.mvc.folder}\VS2010_MVC3_Razor_SampleProject\VS2010_MVC3_Razor_SampleProject\App_Data\NORTHWND_log.ldf" verbose="true" failonerror="true" />
    <copy file="${base.dir}\bin\trial\${assembly.name.mvc}" tofile="${base.dir}\trialMvc\Files\bin\${assembly.name.mvc}" verbose="true"/>
    <copy file="${base.dir}\bin\licensed\${assembly.name.mvc}" tofile="${base.dir}\licensedMvc\Files\bin\${assembly.name.mvc}" verbose="true"/>
  </target>


  <target name="prepareSourceMvc">
    <copy todir="${base.dir}\mvcsource">
      <fileset basedir="${project.folder.mvc}">
        <includes name="**/*.*"/>
      </fileset>
    </copy>
    <delete>
      <fileset basedir="${base.dir}\mvcsource">
        <includes name="**/*.svn"/>
        <includes name="**/*.tmp"/>
        <includes name="**/COMMITMESSAGE.*"/>
        <includes name="**/build.xml"/>
      </fileset>
    </delete>
  </target>

  <target name="zipDeliverables">
    <zip zipfile="${base.dir}\${deliverable.mvc.name}">
      <fileset basedir="${base.dir}\trialMvc">
        <includes name="**/*.*"/>
      </fileset>
    </zip>
    <zip zipfile="${base.dir}\${licensed.deliverable.mvc.name}">
      <fileset basedir="${base.dir}\licensedMvc">
        <includes name="**/*.*"/>
      </fileset>
    </zip>
    <zip zipfile="${base.dir}\${source.name.mvc}">
      <fileset basedir="${base.dir}\mvcsource">
        <includes name="**/*.*"/>
      </fileset>
    </zip>
  </target>

  <target name="run">
    <call target="clean"/>
    <call target="generateCompiledOnStampMvc"/>
    <call target="buildTrialMvc"/>
    <call target="buildLicensedMvc"/>
    <call target="copySampleSiteMvc"/>
    <call target="updateBinariesMvc"/>
    <call target="generateCompiledOnStampMvcSource"/>
    <call target="prepareSourceMvc" />
    <call target="zipDeliverables"/>
  </target>
</project>
